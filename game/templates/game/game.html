{% extends 'game/base.html' %}
{% load static %}

{% block title %}Booì˜ ì¡¸ì—… ëŒ€ëª¨í—˜ - ê²Œì„ í”Œë ˆì´{% endblock %}

{% block meta_description %}Booì˜ ì¡¸ì—… ëŒ€ëª¨í—˜ ê²Œì„ì„ í”Œë ˆì´í•˜ì„¸ìš”! ì¥ì• ë¬¼ì„ ì í”„í•˜ì—¬ í”¼í•˜ê³ , ì•„ì´í…œì„ ìˆ˜ì§‘í•˜ì—¬ ì¡¸ì—…ì„ í–¥í•´ ë„ì „í•˜ì„¸ìš”.{% endblock %}
{% block meta_keywords %}Boo, ì›¹ê²Œì„, ì™¸ëŒ€ ê²Œì„, ì¡¸ì—…ê²Œì„, í”Œë«í¼ê²Œì„, ì¥ì• ë¬¼ ê²Œì„, ì í”„ê²Œì„, ìŠ¤í…Œì´ì§€{% endblock %}

{% block og_title %}Booì˜ ì¡¸ì—… ëŒ€ëª¨í—˜ - ì§€ê¸ˆ í”Œë ˆì´í•˜ì„¸ìš”!{% endblock %}
{% block og_description %}ì¥ì• ë¬¼ì„ í”¼í•˜ê³  Fë¥¼ ê·¹ë³µí•˜ë©° ê¸°ìˆ™ì‚¬ì—ì„œ ì •ë¬¸ê¹Œì§€ Booì™€ í•¨ê»˜ ì¡¸ì—…ì„ í–¥í•´ ë‹¬ë ¤ë³´ì„¸ìš”!{% endblock %}
{% block og_url %}https://boogame.kr/game/play/{% endblock %}
{% block canonical_url %}https://boogame.kr/game/play/{% endblock %}

{% block head_extra %}
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#121212">
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/game.css' %}">
<style>
    /* ëª¨ë°”ì¼ì—ì„œ í„°ì¹˜ ìµœì í™” */
    @media (max-width: 800px) {
        html, body {
            touch-action: none;
            overflow: hidden;
            height: 100%;
            position: fixed;
            width: 100%;
            -webkit-overflow-scrolling: touch;
        }
        
        /* iOSì—ì„œ ë‘ ë²ˆ íƒ­ ë°©ì§€ */
        .game-container {
            touch-action: manipulation;
        }
        
        /* iOSì—ì„œ ì…ë ¥ í•„ë“œ í™•ëŒ€ ë°©ì§€ */
        input {
            font-size: 16px; /* iOSì—ì„œ í™•ëŒ€ ë°©ì§€ë¥¼ ìœ„í•œ ìµœì†Œ í°íŠ¸ í¬ê¸° */
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="game-container">
    <!-- ê²Œì„ UI ìš”ì†Œ -->
    <div class="hud">
        <div class="hud-top">
            <div class="score">ì ìˆ˜: <span id="score">0</span></div>
            <div class="combo hidden" id="comboContainer">
                <span id="comboCount">0</span> ì½¤ë³´!
            </div>
            <div class="timer">ì‹œê°„: <span id="gameTimer">0</span>ì´ˆ</div>
        </div>
        
        <div class="hud-bottom">
            <div class="health">
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
            </div>
            <div class="stage-indicator">
                <span id="currentStage">êµì–‘ê´€</span>
                <div class="stage-progress">
                    <div class="progress-bar" id="stageProgress"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ìº”ë²„ìŠ¤ ê²Œì„ í™”ë©´ -->
    <canvas id="gameCanvas"></canvas>
    
    <!-- íŠ¹ìˆ˜ ì´ë²¤íŠ¸ í‘œì‹œ ì˜ì—­ -->
    <div class="event-notification" id="eventNotification">
        <div class="event-content" id="eventContent"></div>
    </div>
    
    <!-- ê²Œì„ ì‹œì‘ ì¹´ìš´íŠ¸ë‹¤ìš´ -->
    <div class="countdown" id="countdown">
        <span id="countdownNumber">3</span>
    </div>
    
    <!-- ë°©í–¥ ì „í™˜ ì•ˆë‚´ (ëª¨ë°”ì¼ ì„¸ë¡œ ëª¨ë“œ) -->
    <div class="orientation-message" id="orientationMessage" style="display: none;">
        <div class="icon">ğŸ“±</div>
        <div class="text">í™”ë©´ì„ ê°€ë¡œë¡œ ëŒë ¤ì£¼ì„¸ìš”!</div>
        <div class="subtext">ìµœìƒì˜ ê²Œì„ ê²½í—˜ì„ ìœ„í•´ ê°€ë¡œ ë°©í–¥ì„ ê¶Œì¥í•©ë‹ˆë‹¤.</div>
    </div>
    
    <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
    <div class="game-over hidden" id="gameOver">
        <div class="game-over-content">
            <div class="game-stats">
                <h2 id="gameOverTitle">ê²Œì„ ì˜¤ë²„!</h2>
                <p>ìµœì¢… ì ìˆ˜: <span id="finalScore">0</span></p>
                <p>í”Œë ˆì´ ì‹œê°„: <span id="finalTime">0</span>ì´ˆ</p>
                <p>ìŠ¤í…Œì´ì§€: <span id="finalStage">êµì–‘ê´€</span></p>
                
                <div class="achievement-unlocked hidden" id="achievementContainer">
                    <h3>ì—…ì  ë‹¬ì„±!</h3>
                    <div id="achievementsList"></div>
                </div>
            </div>

            <div class="game-inputs">
                <!-- ì´ë¦„ ì…ë ¥ì°½ ë° ì €ì¥ ë²„íŠ¼ -->
                <div class="nickname-save-container">
                    <div class="retro-input-group">
                        <div class="retro-input-label">YOUR NAME?</div>
                        <div class="retro-input-wrapper">
                            <input type="text" id="gameOverNickname" maxlength="12" placeholder="ìµëª…ì˜ í•™ìƒ">
                            <button id="saveNicknameBtn" class="retro-button">SAVE</button>
                        </div>
                        <div class="retro-hint">* ë¯¸ì…ë ¥ì‹œ 'ìµëª…ì˜ í•™ìƒ'ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="restartButton" class="btn-restart">ë‹¤ì‹œ ì‹œì‘</button>
                    <a href="{% url 'game:leaderboard' %}" class="btn-leaderboard">ë¦¬ë”ë³´ë“œ</a>
                    <a href="{% url 'game:index' %}" class="btn-home">í™ˆìœ¼ë¡œ</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ê²Œì„ í´ë¦¬ì–´ í™”ë©´ -->
    <div class="game-clear hidden" id="gameClear">
        <div class="game-over-content">
            <div class="game-stats">
                <h2>ì¶•í•˜í•©ë‹ˆë‹¤! ì¡¸ì—…ì´ë‹¤!</h2>
                <p>ìµœì¢… ì ìˆ˜: <span id="clearScore">0</span></p>
                <p>í”Œë ˆì´ ì‹œê°„: <span id="clearTime">0</span>ì´ˆ</p>
                
                <div class="achievement-unlocked hidden" id="clearAchievementContainer">
                    <h3>ì—…ì  ë‹¬ì„±!</h3>
                    <div id="clearAchievementsList"></div>
                </div>
            </div>
            
            <div class="game-inputs">
                <div class="action-buttons">
                    <button id="clearRestartButton" class="btn-restart">ë‹¤ì‹œ ì‹œì‘</button>
                    <a href="{% url 'game:leaderboard' %}" class="btn-leaderboard">ë¦¬ë”ë³´ë“œ</a>
                    <a href="{% url 'game:index' %}" class="btn-home">í™ˆìœ¼ë¡œ</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ìºë¦­í„° ë° ê²Œì„ ì—ì…‹ ë°ì´í„° -->
<div id="gameAssets" 
     data-player-id="{{ player_id }}"
     data-outfit="{{ customization.outfit }}"
     data-hat="{{ customization.hat }}"
     data-shoes="{{ customization.shoes }}">
</div>
{% endblock %}

{% block dev_template_name %}game.html{% endblock %}

{% block structured_data %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "VideoGame",
  "name": "Booì˜ ì¡¸ì—… ëŒ€ëª¨í—˜",
  "url": "https://boogame.kr/game/play/",
  "description": "ì™¸ëŒ€ìƒ Booê°€ ì¡¸ì—…ì„ í–¥í•´ ì¥ì• ë¬¼ì„ ê·¹ë³µí•˜ëŠ” ì›¹ ê²Œì„",
  "genre": ["Platform", "Arcade", "Casual"],
  "gamePlatform": "Web Browser",
  "applicationCategory": "Game",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "KRW",
    "availability": "http://schema.org/InStock"
  }
}
</script>
{% endblock %}

{% block scripts %}
<script>
  window.PLAYER_ID = "{{ player_id|default:'' }}";
  
  // ëª¨ë°”ì¼ í„°ì¹˜ ì´ë²¤íŠ¸ ìµœì í™”
  document.addEventListener('DOMContentLoaded', function() {
    // iOSì—ì„œ ë”ë¸” íƒ­ ë°©ì§€
    document.addEventListener('touchmove', function(e) {
      if (e.scale !== 1) {
        e.preventDefault();
      }
    }, { passive: false });
    
    // ë°©í–¥ ë©”ì‹œì§€ ì œê±° (ì„¸ë¡œ ëª¨ë“œ ì§€ì›)
    const orientationMessage = document.getElementById('orientationMessage');
    if (orientationMessage) {
      orientationMessage.style.display = 'none';
    }
    
    // ê²Œì„ ì˜¤ë²„ í™”ë©´ì—ì„œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ë„ë¡
    const gameOverElement = document.getElementById('gameOver');
    if (gameOverElement) {
      gameOverElement.addEventListener('touchmove', function(e) {
        e.stopPropagation();
      }, { passive: true });
    }
    
    // ë‹‰ë„¤ì„ ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ì²˜ë¦¬
    const nicknameInput = document.getElementById('gameOverNickname');
    if (nicknameInput) {
      nicknameInput.addEventListener('focus', function() {
        // ì…ë ¥ í•„ë“œê°€ í™”ë©´ì— ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤
        setTimeout(function() {
          nicknameInput.scrollIntoView({behavior: 'smooth', block: 'center'});
        }, 300);
      });
    }
    
    // ëª¨ë°”ì¼ ì„¸ë¡œ í™”ë©´ ìµœì í™”
    function optimizeForPortrait() {
      const gameContainer = document.querySelector('.game-container');
      const canvas = document.getElementById('gameCanvas');
      
      if (gameContainer && canvas && window.innerWidth <= 800) {
        // ì „ì²´ í™”ë©´ ì„¤ì •
        gameContainer.style.width = '100vw';
        gameContainer.style.height = '100vh';
        gameContainer.style.maxHeight = '100vh';
        
        // ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì •
        canvas.style.width = '100%';
        canvas.style.height = '100%';
        
        // ê²Œì„ í¬ê¸° ì—…ë°ì´íŠ¸ (ê²Œì„ ì¸ìŠ¤í„´ìŠ¤ê°€ ìˆëŠ” ê²½ìš°)
        if (window.gameInstance && typeof window.gameInstance.updateCanvasSize === 'function') {
          window.gameInstance.updateCanvasSize();
        }
      }
    }
    
    // ì´ˆê¸° ìµœì í™” ë° resize ì´ë²¤íŠ¸ì— ì—°ê²°
    optimizeForPortrait();
    window.addEventListener('resize', optimizeForPortrait);
  });
</script>
<script src="{% static 'js/game.js' %}"></script>
{% endblock %}